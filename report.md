# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk](#l-1-centralization-risk)
  - [L-2: Literal Instead of Constant](#l-2-literal-instead-of-constant)
  - [L-3: Large Numeric Literal](#l-3-large-numeric-literal)
  - [L-4: Loop Contains `require`/`revert`](#l-4-loop-contains-requirerevert)
  - [L-5: Costly operations inside loop](#l-5-costly-operations-inside-loop)
  - [L-6: Unchecked Return](#l-6-unchecked-return)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 10 |
| Total nSLOC | 719 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| src/adapter/PriceLoomAdapterFactory.sol | 30 |
| src/adapter/PriceLoomAggregatorV3Adapter.sol | 51 |
| src/examples/TestPriceConsumer.sol | 12 |
| src/interfaces/AggregatorV3Interface.sol | 14 |
| src/interfaces/IOracleAdmin.sol | 10 |
| src/interfaces/IOracleReader.sol | 20 |
| src/libraries/PriceLoomMath.sol | 35 |
| src/libraries/Sort.sol | 7 |
| src/oracle/PriceLoomOracle.sol | 516 |
| src/oracle/PriceLoomTypes.sol | 24 |
| **Total** | **719** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 0 |
| Low | 6 |


# Low Issues

## L-1: Centralization Risk

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details><summary>7 Found Instances</summary>


- Found in src/oracle/PriceLoomOracle.sol [Line: 63](src/oracle/PriceLoomOracle.sol#L63)

	```solidity
	contract PriceLoomOracle is AccessControl, Pausable, ReentrancyGuard, EIP712, IOracleAdmin, IOracleReader {
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 120](src/oracle/PriceLoomOracle.sol#L120)

	```solidity
	        onlyRole(FEED_ADMIN_ROLE)
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 155](src/oracle/PriceLoomOracle.sol#L155)

	```solidity
	    function setFeedConfig(bytes32 feedId, OracleTypes.FeedConfig calldata cfg) external onlyRole(FEED_ADMIN_ROLE) {
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 166](src/oracle/PriceLoomOracle.sol#L166)

	```solidity
	    function addOperator(bytes32 feedId, address op) external onlyRole(FEED_ADMIN_ROLE) {
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 177](src/oracle/PriceLoomOracle.sol#L177)

	```solidity
	    function removeOperator(bytes32 feedId, address op) external onlyRole(FEED_ADMIN_ROLE) {
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 199](src/oracle/PriceLoomOracle.sol#L199)

	```solidity
	    function pause() external onlyRole(PAUSER_ROLE) {
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 203](src/oracle/PriceLoomOracle.sol#L203)

	```solidity
	    function unpause() external onlyRole(PAUSER_ROLE) {
	```

</details>



## L-2: Literal Instead of Constant

Define and use `constant` variables instead of using literals. If the same constant literal value is used multiple times, create a constant state variable and reference it throughout the contract.

<details><summary>4 Found Instances</summary>


- Found in src/libraries/PriceLoomMath.sol [Line: 16](src/libraries/PriceLoomMath.sol#L16)

	```solidity
	            return (uint256(1) << 255);
	```

- Found in src/libraries/PriceLoomMath.sol [Line: 25](src/libraries/PriceLoomMath.sol#L25)

	```solidity
	            uint256 ua = uint256(a) ^ (uint256(1) << 255);
	```

- Found in src/libraries/PriceLoomMath.sol [Line: 26](src/libraries/PriceLoomMath.sol#L26)

	```solidity
	            uint256 ub = uint256(b) ^ (uint256(1) << 255);
	```

- Found in src/libraries/PriceLoomMath.sol [Line: 46](src/libraries/PriceLoomMath.sol#L46)

	```solidity
	            if (mu == (uint256(1) << 255)) return type(int256).min;
	```

</details>



## L-3: Large Numeric Literal

Large literal values multiples of 10000 can be replaced with scientific notation.Use `e` notation, for example: `1e18`, instead of its full numeric value.

<details><summary>1 Found Instances</summary>


- Found in src/oracle/PriceLoomOracle.sol [Line: 605](src/oracle/PriceLoomOracle.sol#L605)

	```solidity
	        return OZMath.mulDiv(diff, 10_000, lastAbs) >= uint256(cfg.deviationBps);
	```

</details>



## L-4: Loop Contains `require`/`revert`

Avoid `require` / `revert` statements in a loop because a single bad item can cause the whole transaction to fail. It's better to forgive on fail and return failed elements post processing of the loop

<details><summary>2 Found Instances</summary>


- Found in src/oracle/PriceLoomOracle.sol [Line: 131](src/oracle/PriceLoomOracle.sol#L131)

	```solidity
	            for (uint8 i = 0; i < operators.length; i++) {
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 428](src/oracle/PriceLoomOracle.sol#L428)

	```solidity
	        for (uint256 i = 0; i < subs.length; i++) {
	```

</details>



## L-5: Costly operations inside loop

Invoking `SSTORE` operations in loops may waste gas. Use a local variable to hold the loop computation result.

<details><summary>3 Found Instances</summary>


- Found in src/oracle/PriceLoomOracle.sol [Line: 131](src/oracle/PriceLoomOracle.sol#L131)

	```solidity
	            for (uint8 i = 0; i < operators.length; i++) {
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 428](src/oracle/PriceLoomOracle.sol#L428)

	```solidity
	        for (uint256 i = 0; i < subs.length; i++) {
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 531](src/oracle/PriceLoomOracle.sol#L531)

	```solidity
	        for (uint8 i = 0; i < submissionCount; i++) {
	```

</details>



## L-6: Unchecked Return

Function returns a value but it is ignored. Consider checking the return value.

<details><summary>6 Found Instances</summary>


- Found in src/oracle/PriceLoomOracle.sol [Line: 108](src/oracle/PriceLoomOracle.sol#L108)

	```solidity
	        _grantRole(DEFAULT_ADMIN_ROLE, admin);
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 109](src/oracle/PriceLoomOracle.sol#L109)

	```solidity
	        _grantRole(PAUSER_ROLE, admin);
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 110](src/oracle/PriceLoomOracle.sol#L110)

	```solidity
	        _grantRole(FEED_ADMIN_ROLE, admin);
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 318](src/oracle/PriceLoomOracle.sol#L318)

	```solidity
	        _handleTimeoutIfNeeded(feedId);
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 341](src/oracle/PriceLoomOracle.sol#L341)

	```solidity
	        _handleTimeoutIfNeeded(feedId);
	```

- Found in src/oracle/PriceLoomOracle.sol [Line: 393](src/oracle/PriceLoomOracle.sol#L393)

	```solidity
	        _handleTimeoutIfNeeded(feedId);
	```

</details>



